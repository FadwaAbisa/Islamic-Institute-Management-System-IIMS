# نظام إدارة الحضور والغياب - Islamic Institute Management System

## نظرة عامة

تم تطوير نظام شامل لإدارة الحضور والغياب في المعهد الإسلامي، يتصل بقاعدة البيانات PostgreSQL عبر Prisma ORM.

## الميزات الرئيسية

### 1. إدارة الطلاب
- جلب الطلاب من قاعدة البيانات
- فلترة حسب المستوى الدراسي
- عرض معلومات الطالب (الاسم، الصورة، التخصص)

### 2. إدارة المواد الدراسية
- جلب المواد من قاعدة البيانات
- عرض المعلمين المسؤولين عن كل مادة
- فلترة حسب السنة الأكاديمية

### 3. تسجيل الحضور
- تسجيل حضور/غياب/تأخير/إجازة لكل طالب
- تحديث جماعي لحالة الحضور
- إضافة ملاحظات لكل طالب
- حفظ البيانات في قاعدة البيانات

### 4. التقارير والإحصائيات
- عرض إحصائيات الحضور في الوقت الفعلي
- تصدير البيانات بصيغة CSV
- فلترة وبحث في سجلات الحضور

## البنية التقنية

### الملفات الرئيسية

#### 1. `src/components/attendance-management.tsx`
المكون الرئيسي لإدارة الحضور، يحتوي على:
- واجهة المستخدم الكاملة
- منطق إدارة الحالة
- دوال الاتصال بقاعدة البيانات

#### 2. `src/app/api/attendance/route.ts`
API endpoint لإدارة سجلات الحضور:
- `GET`: جلب سجلات الحضور
- `POST`: إضافة/تحديث سجل حضور

#### 3. `src/app/api/students/route.ts`
API endpoint لجلب بيانات الطلاب:
- `GET`: جلب الطلاب مع فلترة حسب المستوى

#### 4. `src/app/api/subjects/route.ts`
API endpoint لجلب المواد الدراسية:
- `GET`: جلب المواد مع معلومات المعلمين

### قاعدة البيانات

#### نموذج `Attendance`
```prisma
model Attendance {
  id        Int      @id @default(autoincrement())
  date      DateTime
  present   Boolean
  studentId String
  lessonId  Int
  Student   Student  @relation(fields: [studentId], references: [id])
}
```

#### نموذج `Student`
```prisma
model Student {
  id           String   @id
  fullName     String
  studentPhoto String?
  studyLevel   StudyLevel?
  specialization String?
  // ... المزيد من الحقول
}
```

#### نموذج `Subject`
```prisma
model Subject {
  id             Int              @id @default(autoincrement())
  name           String           @unique
  academicYear   String?
  TeacherSubject TeacherSubject[]
}
```

## كيفية الاستخدام

### 1. تسجيل الدخول
يجب أن يكون المستخدم مسجل الدخول عبر Clerk للوصول للنظام.

### 2. اختيار المعايير
- **المستوى الدراسي**: اختر المستوى (أولى، ثانية، ثالثة، تخرج)
- **التاريخ**: اختر تاريخ تسجيل الحضور
- **المادة**: اختر المادة الدراسية

### 3. تسجيل الحضور
1. اضغط على "تسجيل الحضور"
2. اختر حالة كل طالب (حاضر، غائب، متأخر، إجازة)
3. أضف ملاحظات إذا لزم الأمر
4. اضغط "حفظ" لحفظ البيانات

### 4. التحديث الجماعي
- حدد عدة طلاب باستخدام مربعات الاختيار
- اختر الحالة المطلوبة
- اضغط "تطبيق على المحدد"

### 5. تصدير البيانات
- اضغط على زر التحميل لتصدير البيانات بصيغة CSV

## الأمان والصلاحيات

- يتم التحقق من تسجيل الدخول عبر Clerk
- كل طلب API يتطلب مصادقة صالحة
- يمكن إضافة صلاحيات إضافية حسب الدور (مدير، معلم، إلخ)

## التطوير المستقبلي

### الميزات المقترحة
1. **إشعارات الوالدين**: إرسال إشعارات عند غياب الطالب
2. **تقارير متقدمة**: رسوم بيانية وإحصائيات مفصلة
3. **جدول الحصص**: ربط الحضور بجدول الحصص
4. **نظام العقوبات**: تتبع الغياب المتكرر
5. **تطبيق الهاتف**: تسجيل الحضور من الهاتف المحمول

### التحسينات التقنية
1. **Caching**: تخزين مؤقت للبيانات المتكررة
2. **Real-time Updates**: تحديثات فورية عبر WebSockets
3. **Offline Support**: العمل بدون اتصال بالإنترنت
4. **Performance**: تحسين سرعة الاستعلامات

## استكشاف الأخطاء

### مشاكل شائعة

#### 1. عدم ظهور الطلاب
- تأكد من وجود طلاب في قاعدة البيانات
- تحقق من صحة API endpoint
- تأكد من صحة فلترة المستوى الدراسي

#### 2. عدم حفظ الحضور
- تحقق من صحة البيانات المرسلة
- تأكد من وجود اتصال بقاعدة البيانات
- تحقق من سجلات الخطأ في Console

#### 3. بطء في التحميل
- تحقق من حجم البيانات
- فكر في إضافة pagination
- تحقق من أداء قاعدة البيانات

## الدعم والمساعدة

للمساعدة أو الإبلاغ عن مشاكل:
1. تحقق من سجلات Console
2. راجع سجلات الخادم
3. تأكد من صحة إعدادات قاعدة البيانات
4. تحقق من صحة متغيرات البيئة

## الخلاصة

نظام إدارة الحضور والغياب يوفر حلاً شاملاً ومتطوراً لإدارة حضور الطلاب في المعهد الإسلامي. النظام مصمم ليكون سهل الاستخدام وقابل للتوسع، مع التركيز على الأمان والأداء.
