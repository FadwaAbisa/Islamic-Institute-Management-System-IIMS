# دليل إعادة تعيين قاعدة البيانات واستيراد البيانات

## نظرة عامة
هذا الدليل يوضح كيفية حذف جميع البيانات من قاعدة البيانات وإعادة استيرادها من ملف الإكسل.

## الملفات المتاحة

### 1. `reset-and-import.js` - السكريبت الرئيسي
يقوم هذا السكريبت بـ:
- حذف جميع البيانات من جميع الجداول
- إعادة إنشاء البيانات الأساسية (المراحل، المواد، الفصول)
- استيراد الطلاب من ملف `data/students_db.xlsx`

**طريقة الاستخدام:**
```bash
node prisma/reset-and-import.js
```

### 2. `check-subjects.js` - فحص المواد
يقوم هذا السكريبت بـ:
- عرض جميع المواد الموجودة في قاعدة البيانات
- مقارنة المواد الموجودة مع المواد المطلوبة
- تحديد المواد المفقودة

**طريقة الاستخدام:**
```bash
node prisma/check-subjects.js
```

### 3. `check-students.js` - فحص الطلاب
يقوم هذا السكريبت بـ:
- عرض إجمالي عدد الطلاب
- عرض عينة من الطلاب المستوردين
- عرض إحصائيات الطلاب النشطين

**طريقة الاستخدام:**
```bash
node prisma/check-students.js
```

### 4. `add-missing-subjects.js` - إضافة المواد المفقودة
يقوم هذا السكريبت بـ:
- فحص المواد الموجودة
- إضافة المواد المفقودة تلقائياً

**طريقة الاستخدام:**
```bash
node prisma/add-missing-subjects.js
```

## خطوات إعادة تعيين قاعدة البيانات

### الخطوة 1: إعادة تعيين كاملة
```bash
node prisma/reset-and-import.js
```

### الخطوة 2: التحقق من المواد
```bash
node prisma/check-subjects.js
```

### الخطوة 3: التحقق من الطلاب
```bash
node prisma/check-students.js
```

### الخطوة 4: إضافة المواد المفقودة (إذا لزم الأمر)
```bash
node prisma/add-missing-subjects.js
```

## البيانات التي يتم إنشاؤها تلقائياً

### المراحل الدراسية
- الصف الأول (ID: 1)
- الصف الثاني (ID: 2)
- الصف الثالث (ID: 3)
- الصف الرابع (ID: 4)
- الصف الخامس (ID: 5)
- الصف السادس (ID: 6)

### المواد الدراسية
1. القرآن الكريم و احكام التجويد
2. علم الحديث
3. الفقه
4. التفسير
5. العقيدة
6. الدراسات الادبية
7. الدراسات اللغوية
8. السيرة
9. اللغة الانجليزية
10. الحاسوب
11. منهج الدعوة
12. أصول الفقة

### الفصول الدراسية
- الصف الأول أ (السعة: 30)
- الصف الأول ب (السعة: 30)
- الصف الثاني أ (السعة: 30)
- الصف الثاني ب (السعة: 30)

## ملاحظات مهمة

⚠️ **تحذير**: سكريبت `reset-and-import.js` يحذف جميع البيانات من قاعدة البيانات. تأكد من عمل نسخة احتياطية قبل التشغيل.

✅ **تأكد من وجود ملف الإكسل**: تأكد من وجود ملف `data/students_db.xlsx` قبل تشغيل السكريبت.

🔄 **ترتيب الحذف**: يتم حذف البيانات بترتيب صحيح لتجنب مشاكل العلاقات بين الجداول.

📊 **عدد الطلاب**: يتم استيراد جميع الطلاب من ملف الإكسل (251 طالب في المثال الحالي).

## استكشاف الأخطاء

### مشكلة: لا يمكن الاتصال بقاعدة البيانات
- تأكد من تشغيل قاعدة البيانات
- تحقق من متغيرات البيئة `DATABASE_URL`

### مشكلة: خطأ في قراءة ملف الإكسل
- تأكد من وجود ملف `data/students_db.xlsx`
- تحقق من صحة تنسيق الملف

### مشكلة: خطأ في إنشاء البيانات
- تحقق من صحة schema.prisma
- تأكد من تشغيل `prisma generate`

## الدعم

إذا واجهت أي مشاكل، راجع:
1. ملفات السجلات (logs)
2. رسائل الخطأ في Terminal
3. حالة قاعدة البيانات
4. صحة ملف schema.prisma
